import{r as n,w as Y,o as Z,c as x,a as u,b as r,t as p,d as l,e as t,g as M,f as y,h as i,u as s,F as V,i as L,j as g,n as ee,l as ae,m as w,v as $,p as te}from"./index-FaBaPTSp.js";import{_ as re,a as le}from"./AdminLayout-CXIueKdX.js";import{_ as se,a as oe,b as ie,c as P,d as v,e as ne,f as m,m as de,g as ue,h as pe,i as ge,j as fe,k as me,l as ce}from"./PaginationPrevious.vue_vue_type_script_setup_true_lang-C-2Z8lsJ.js";import{_ as T,a as ve,b as be}from"./DeleteConfirmDialog-D_weW5_R.js";import{g as N,p as ye,a as ke,d as xe}from"./http-VbNDWnN5.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const we=f=>N("/ai/configs/",{params:f}),_e=f=>ke("/ai/configs/",f),he=f=>N(`/ai/configs/${f}`),$e=(f,O)=>ye(`/ai/configs/${f}/`,O),Ae=f=>xe(`/ai/configs/${f}/`),Ce={class:"space-y-5 sm:space-y-6"},De={class:"mb-4 flex items-center justify-between"},ze={class:"flex gap-2"},Ie=["title"],Ve=["title"],Te={class:"flex items-center justify-end gap-2"},Oe=["onClick"],Ue={key:0,class:"mt-4"},je={class:"relative z-10 w-full max-w-xl rounded-xl bg-white p-6 shadow-lg dark:bg-gray-900"},Be={class:"mb-4 text-lg font-semibold"},Ge=["value"],Me={class:"flex justify-end gap-3 pt-2"},Le={key:0,class:"mr-2"},Ke={__name:"index",setup(f){const O=n("AI 服务配置"),U=n([]),_=n(1),E=n(20),j=n(0),F=n("");n(null),n(!1);const K=n([{title:"OpenAI",value:"openai"},{title:"Azure OpenAI",value:"azure"},{title:"Google Gemini",value:"gemini"},{title:"Anthropic",value:"anthropic"},{title:"Custom",value:"custom"},{title:"Grok",value:"grok"},{title:"Deepseek",value:"deepseek"}]),Q={openai:"OpenAI",azure:"Azure OpenAI",gemini:"Google Gemini",anthropic:"Anthropic Claude",together:"Together Al",deepseek:"Deepseek",moonshot:"Moonshot",zhipuai:"智谱AI",custom:"自定义OpenAl兼容接口"};async function q(d){try{const e=await he(d.id);c.value=!0,C.value=d.id,o.value={name:e.name||"",provider:e.provider||"",priority:e.priority||"",api_key:e.api_key||"",base_url:e.base_url||"",model:e.model||""},A.value=!0}catch(e){console.error("获取详情失败:",e),p.error("获取详情失败")}}function H(d,e){z.value=d;const a=e.target.getBoundingClientRect();S.value={top:a.top,left:a.left,width:a.width,height:a.height,bottom:a.bottom},B.value=!0}async function J(){var d,e;if(z.value){D.value=!0;try{await Ae(z.value.id),p.success("删除成功"),await I(),R()}catch(a){console.error("删除失败:",a),p.error("删除失败",{description:((e=(d=a.response)==null?void 0:d.data)==null?void 0:e.message)||a.message||"删除配置时发生错误"})}finally{D.value=!1}}}function R(){B.value=!1,z.value=null,D.value=!1}const A=n(!1),c=n(!1),C=n(null),k=n(!1),B=n(!1),D=n(!1),z=n(null),S=n({top:0,left:0,width:0,height:0}),o=n({name:"",provider:"",priority:"",api_key:"",base_url:"",model:""});function W(){c.value=!1,C.value=null,o.value={name:"",provider:"",priority:"",api_key:"",base_url:"",model:""},A.value=!0}function G(){A.value=!1,c.value=!1,C.value=null,o.value={name:"",provider:"",priority:"",api_key:"",base_url:"",model:""}}async function X(){var d,e;if(!k.value){if(!o.value.name||o.value.name.trim()===""){p.error("请填写配置名称",{description:"配置名称不能为空"});return}if(!o.value.provider||o.value.provider===""){p.error("请选择平台名称",{description:"平台名称不能为空"});return}if(!o.value.api_key||o.value.api_key.trim()===""){p.error("请填写API Key",{description:"API Key不能为空"});return}if(!o.value.model||o.value.model.trim()===""){p.error("请填写模型名称",{description:"模型名称不能为空"});return}if(!o.value.priority||o.value.priority===""){p.error("请填写优先级",{description:"优先级不能为空"});return}k.value=!0;try{const a={name:o.value.name.trim(),provider:o.value.provider,priority:o.value.priority,api_key:o.value.api_key.trim(),base_url:o.value.base_url.trim(),model:o.value.model.trim()};c.value?(await $e(C.value,a),p.success("配置更新成功")):(await _e(a),p.success("配置新增成功")),G(),await I()}catch(a){console.error(c.value?"更新失败:":"新增失败:",a),p.error(c.value?"更新失败":"新增失败",{description:((e=(d=a.response)==null?void 0:d.data)==null?void 0:e.message)||a.message||(c.value?"更新配置时发生错误":"新增配置时发生错误")})}finally{k.value=!1}}}const I=async()=>{var d,e;try{let a=await we({search:F.value,page:_.value});U.value=a.results,j.value=a.count}catch(a){console.error("获取列表失败:",a),p.error("获取列表失败",{description:((e=(d=a.response)==null?void 0:d.data)==null?void 0:e.message)||a.message||"获取配置列表时发生错误"})}};return Y(_,d=>{console.log("Page changed to:",d),I()}),Z(()=>{I()}),(d,e)=>(u(),x(re,null,{default:r(()=>[l(le,{pageTitle:O.value},null,8,["pageTitle"]),t("div",Ce,[l(se,null,{default:r(()=>[t("div",De,[e[8]||(e[8]=t("div",{class:"flex items-center gap-3"},null,-1)),t("div",ze,[l(T,{size:"sm",onClick:W},{default:r(()=>[...e[7]||(e[7]=[i("新增",-1)])]),_:1})])]),l(s(oe),{class:"[&_td]:py-3.5 [&_th]:py-3.5"},{default:r(()=>[l(s(ie),null,{default:r(()=>[l(s(P),null,{default:r(()=>[l(s(v),{class:"whitespace-nowrap"},{default:r(()=>[...e[9]||(e[9]=[i("序号",-1)])]),_:1}),l(s(v),{class:"whitespace-nowrap"},{default:r(()=>[...e[10]||(e[10]=[i("配置名称",-1)])]),_:1}),l(s(v),{class:"whitespace-nowrap"},{default:r(()=>[...e[11]||(e[11]=[i("平台名称",-1)])]),_:1}),l(s(v),{class:"whitespace-nowrap"},{default:r(()=>[...e[12]||(e[12]=[i("key",-1)])]),_:1}),l(s(v),{class:"whitespace-nowrap"},{default:r(()=>[...e[13]||(e[13]=[i("基础地址",-1)])]),_:1}),l(s(v),{class:"whitespace-nowrap"},{default:r(()=>[...e[14]||(e[14]=[i("状态",-1)])]),_:1}),l(s(v),{class:"whitespace-nowrap"},{default:r(()=>[...e[15]||(e[15]=[i("优先级",-1)])]),_:1}),l(s(v),{class:"whitespace-nowrap"},{default:r(()=>[...e[16]||(e[16]=[i("创建时间",-1)])]),_:1}),l(s(v),{class:"whitespace-nowrap text-right"},{default:r(()=>[...e[17]||(e[17]=[i("操作",-1)])]),_:1})]),_:1})]),_:1}),l(s(ne),null,{default:r(()=>[U.value.length?(u(!0),y(V,{key:0},L(U.value,(a,b)=>(u(),x(s(P),{key:a.id},{default:r(()=>[l(s(m),{class:"whitespace-nowrap"},{default:r(()=>[i(g(b+1),1)]),_:2},1024),l(s(m),{class:"whitespace-nowrap"},{default:r(()=>[i(g(a.name),1)]),_:2},1024),l(s(m),{class:"whitespace-nowrap"},{default:r(()=>[i(g(Q[a.provider]),1)]),_:2},1024),l(s(m),null,{default:r(()=>[t("div",{class:"max-w-[200px] truncate",title:a.api_key},g(a.api_key),9,Ie)]),_:2},1024),l(s(m),null,{default:r(()=>[t("div",{class:"max-w-[200px] truncate",title:a.base_url},g(a.base_url),9,Ve)]),_:2},1024),l(s(m),{class:"whitespace-nowrap"},{default:r(()=>[t("span",{class:ee(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ring-1 ring-inset",a.enabled?"bg-emerald-50 text-emerald-600 ring-emerald-200 dark:bg-emerald-500/10 dark:text-emerald-400 dark:ring-emerald-500/30":"bg-rose-50 text-rose-600 ring-rose-200 dark:bg-rose-500/10 dark:text-rose-400 dark:ring-rose-500/30"])},g(a.enabled?"正常":"禁用"),3)]),_:2},1024),l(s(m),{class:"whitespace-nowrap"},{default:r(()=>[i(g(a.priority),1)]),_:2},1024),l(s(m),{class:"whitespace-nowrap"},{default:r(()=>[i(g(s(de)(a.created_at)),1)]),_:2},1024),l(s(m),{class:"text-right whitespace-nowrap"},{default:r(()=>[t("div",Te,[l(T,{size:"sm",variant:"outline",onClick:h=>q(a)},{default:r(()=>[...e[18]||(e[18]=[i("编辑",-1)])]),_:1},8,["onClick"]),t("button",{class:"inline-flex items-center justify-center font-medium gap-2 rounded-lg transition px-4 py-3 text-sm bg-white text-gray-700 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:ring-gray-700 dark:hover:bg-white/[0.03] dark:hover:text-gray-300 text-rose-600 ring-rose-200 hover:bg-rose-50 dark:text-rose-400 dark:ring-rose-500/30",onClick:h=>H(a,h)}," 删除 ",8,Oe)])]),_:2},1024)]),_:2},1024))),128)):(u(),x(s(P),{key:1},{default:r(()=>[l(s(m),{colspan:7,class:"py-16 text-center text-gray-400 dark:text-white/40"},{default:r(()=>[...e[19]||(e[19]=[i("暂无数据",-1)])]),_:1})]),_:1}))]),_:1})]),_:1}),j.value>0?(u(),y("div",Ue,[l(s(ue),{page:_.value,"onUpdate:page":e[0]||(e[0]=a=>_.value=a),total:j.value,"items-per-page":E.value,"sibling-count":1},{default:r(()=>[l(s(pe),null,{default:r(({items:a})=>[l(s(ge)),(u(!0),y(V,null,L(a,(b,h)=>(u(),y(V,{key:h},[b.type==="page"?(u(),x(s(fe),{key:0,value:b.value,"is-active":b.value===_.value},{default:r(()=>[i(g(b.value),1)]),_:2},1032,["value","is-active"])):(u(),x(s(me),{key:1,index:h},null,8,["index"]))],64))),128)),l(s(ce))]),_:1})]),_:1},8,["page","total","items-per-page"])])):M("",!0)]),_:1}),A.value?(u(),x(ve,{key:0,fullScreenBackdrop:!0,onClose:G},{body:r(()=>[t("div",je,[t("h3",Be,g(c.value?"编辑服务配置":"新增服务配置"),1),t("form",{onSubmit:ae(X,["prevent"]),class:"space-y-4"},[t("div",null,[e[20]||(e[20]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[i("配置名称"),t("span",{class:"text-error-500"},"*")],-1)),w(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.name=a),type:"text",placeholder:"如：OpenAI GPT-4配置",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[$,o.value.name]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[i("平台名称"),t("span",{class:"text-error-500"},"*")],-1)),w(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.provider=a),class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},[e[21]||(e[21]=t("option",{value:""},"请选择平台",-1)),(u(!0),y(V,null,L(K.value,(a,b)=>(u(),y("option",{value:a.value,key:b},g(a.title),9,Ge))),128))],512),[[te,o.value.provider]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[i("key"),t("span",{class:"text-error-500"},"*")],-1)),w(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.api_key=a),type:"password",placeholder:"请输入key",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[$,o.value.api_key]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},"基础地址",-1)),w(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.base_url=a),type:"text",placeholder:"如：https://api.openai.com/v1",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[$,o.value.base_url]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[i("模型名称"),t("span",{class:"text-error-500"},"*")],-1)),w(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.model=a),type:"text",placeholder:"如：gpt-4、claude-3-sonnet",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[$,o.value.model]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"},[i("优先级"),t("span",{class:"text-error-500"},"*")],-1)),w(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.priority=a),type:"number",placeholder:"如：8",class:"dark:bg-dark-900 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 shadow-theme-xs placeholder:text-gray-400 focus:border-brand-300 focus:outline-hidden focus:ring-3 focus:ring-brand-500/10 dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30 dark:focus:border-brand-800"},null,512),[[$,o.value.priority]])]),t("div",Me,[l(T,{type:"button",variant:"outline",onClick:G,disabled:k.value},{default:r(()=>[...e[27]||(e[27]=[i("取消",-1)])]),_:1},8,["disabled"]),l(T,{type:"submit",disabled:k.value},{default:r(()=>[k.value?(u(),y("span",Le,"处理中...")):M("",!0),i(" "+g(c.value?"更新":"保存"),1)]),_:1},8,["disabled"])])],32)])]),_:1})):M("",!0),l(be,{isOpen:B.value,title:"删除",description:"确定要删除吗？此操作不可撤销。",isLoading:D.value,triggerRect:S.value,onClose:R,onConfirm:J},null,8,["isOpen","isLoading","triggerRect"])])]),_:1}))}};export{Ke as default};
